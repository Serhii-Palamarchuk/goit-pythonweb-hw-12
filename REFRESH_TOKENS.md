# JWT Refresh Token Implementation

## üîÑ **–ú–µ—Ö–∞–Ω—ñ–∑–º –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ –¥–æ—Å—Ç—É–ø—É**

–ù–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä –ø—ñ–¥—Ç—Ä–∏–º—É—î –±–µ–∑–ø–µ—á–Ω–∏–π –º–µ—Ö–∞–Ω—ñ–∑–º –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ –¥–æ—Å—Ç—É–ø—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `refresh_token`.

### üéØ **–û—Å–Ω–æ–≤–Ω—ñ –æ—Å–æ–±–ª–∏–≤–æ—Å—Ç—ñ:**

1. **–ü–æ–¥–≤—ñ–π–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ç–æ–∫–µ–Ω—ñ–≤:**
   - `access_token` - –∫–æ—Ä–æ—Ç–∫–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∏–π (30 —Ö–≤–∏–ª–∏–Ω)
   - `refresh_token` - –¥–æ–≤–≥–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∏–π (7 –¥–Ω—ñ–≤)

2. **–ë–µ–∑–ø–µ—á–Ω—ñ—Å—Ç—å:**
   - –†—ñ–∑–Ω—ñ scope –¥–ª—è access —ñ refresh —Ç–æ–∫–µ–Ω—ñ–≤
   - –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–∏–ø—É —Ç–æ–∫–µ–Ω—É –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–±–æ—Ö —Ç–æ–∫–µ–Ω—ñ–≤

### üìã **API Endpoints:**

#### 1. **POST /auth/login** (–æ–Ω–æ–≤–ª–µ–Ω–æ)
–¢–µ–ø–µ—Ä –ø–æ–≤–µ—Ä—Ç–∞—î –æ–±–∏–¥–≤–∞ —Ç–æ–∫–µ–Ω–∏:

```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "refresh_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "token_type": "bearer"
}
```

#### 2. **POST /auth/refresh** (–Ω–æ–≤–∏–π)
–û–Ω–æ–≤–ª—é—î —Ç–æ–∫–µ–Ω–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é refresh_token:

**Request:**
```json
{
  "refresh_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9..."
}
```

**Response:**
```json
{
  "access_token": "NEW_ACCESS_TOKEN_HERE",
  "refresh_token": "NEW_REFRESH_TOKEN_HERE", 
  "token_type": "bearer"
}
```

### üõ°Ô∏è **–ë–µ–∑–ø–µ–∫–∞:**

1. **Scope –≤–∞–ª—ñ–¥–∞—Ü—ñ—è** - access —Ç–æ–∫–µ–Ω –Ω–µ –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è —è–∫ refresh
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è** - –ø—Ä–∏ refresh –≤–∏–¥–∞—é—Ç—å—Å—è –Ω–æ–≤—ñ –æ–±–∏–¥–≤–∞ —Ç–æ–∫–µ–Ω–∏
3. **–†—ñ–∑–Ω—ñ —Ç–µ—Ä–º—ñ–Ω–∏ –¥—ñ—ó** - access (30 —Ö–≤) vs refresh (7 –¥–Ω—ñ–≤)
4. **JWT –ø—ñ–¥–ø–∏—Å** - –≤—Å—ñ —Ç–æ–∫–µ–Ω–∏ –ø—ñ–¥–ø–∏—Å–∞–Ω—ñ —Å–µ–∫—Ä–µ—Ç–Ω–∏–º –∫–ª—é—á–µ–º

### üíª **–ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –∫–ª—ñ—î–Ω—Ç—ñ:**

```javascript
// 1. –õ–æ–≥—ñ–Ω —ñ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤
const loginResponse = await fetch('/auth/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
  body: 'username=user&password=pass'
});
const { access_token, refresh_token } = await loginResponse.json();

// 2. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è access_token –¥–ª—è API –∑–∞–ø–∏—Ç—ñ–≤
const apiResponse = await fetch('/contacts/', {
  headers: { 'Authorization': `Bearer ${access_token}` }
});

// 3. –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤ –∫–æ–ª–∏ access_token –∑–∞–∫—ñ–Ω—á—É—î—Ç—å—Å—è
const refreshResponse = await fetch('/auth/refresh', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ refresh_token })
});
const newTokens = await refreshResponse.json();
```

### ‚ö†Ô∏è **–í–∞–∂–ª–∏–≤—ñ –º–æ–º–µ–Ω—Ç–∏:**

1. **–ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤:**
   - `access_token` - –≤ –ø–∞–º'—è—Ç—ñ (sessionStorage)
   - `refresh_token` - –≤ –±–µ–∑–ø–µ—á–Ω–æ–º—É cookie (httpOnly)

2. **–û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫:**
   - `401 Unauthorized` - —Ç–æ–∫–µ–Ω –Ω–µ–¥—ñ–π—Å–Ω–∏–π/–∑–∞–∫—ñ–Ω—á–∏–≤—Å—è
   - `422 Unprocessable Entity` - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω—É

3. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—è:**
   - –ö–ª—ñ—î–Ω—Ç –ø–æ–≤–∏–Ω–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Ç–æ–∫–µ–Ω–∏
   - –ü—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ refresh - –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞ –ª–æ–≥—ñ–Ω

### üß™ **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è:**

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤ refresh —Ç–æ–∫–µ–Ω—ñ–≤
poetry run pytest tests/test_refresh_tokens.py -v
```

**–í—Å—ñ —Ç–µ—Å—Ç–∏ –ø—Ä–æ–π—à–ª–∏ —É—Å–ø—ñ—à–Ω–æ:** ‚úÖ
- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è refresh —Ç–æ–∫–µ–Ω—ñ–≤
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–æ–∫–µ–Ω—ñ–≤  
- –†—ñ–∑–Ω—ñ scope –¥–ª—è access/refresh
- –†—ñ–∑–Ω—ñ —Ç–µ—Ä–º—ñ–Ω–∏ –¥—ñ—ó
- API —Å—Ö–µ–º–∏

## üéâ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

JWT —Ç–æ–∫–µ–Ω–∏ –∑ –º–µ—Ö–∞–Ω—ñ–∑–º–æ–º refresh **–ü–û–í–ù–Ü–°–¢–Æ –†–ï–ê–õ–Ü–ó–û–í–ê–ù–Ü** –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –≤–∏–º–æ–≥ –¥–æ–º–∞—à–∫–∏ HW-12!